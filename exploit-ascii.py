#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-
import re
import os
import sys
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)) + "/lib" )

## Load WeChall Exploit Framework
import wcef

## Pass over a string of Cookie to the WeChall object if it is given from command line
if len(sys.argv) == 2:
	wechall = wcef.WeChall(sys.argv[1])
else:
	wechall = wcef.WeChall()

## Open the problem page as a Mechanize object
problem_url  = "http://www.wechall.net/challenge/training/encodings/ascii/index.php"
wechall.open( problem_url )

## Extract a line that includes a sequence of ASCII codes from the problem page
ascii_code = re.search(r'(\d{1,3}, ){3,}\d{1,3}', wechall.text).group().split(", ")

## Convert each ASCII codes into characters
ascii_text = ''.join( [chr(int(code)) for code in ascii_code] )

## Extract only the necessary part from the solution text
solution = ascii_text.split(": ")[1]

## Submit solution to the WeChall server
wechall.submit(solution)

## Print the solution
print("The solution was: %s" % solution)

# [EOF]
